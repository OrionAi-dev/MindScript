# Robot Framework Mapper

This adapter connects OpenSpec `@software` criteria to **Robot Framework** by **referencing external artifacts only**. It does **not** generate `.robot` files or embed Robot syntax into OpenSpec. It verifies links to `.robot` test cases you reference and produces a traceability index.

## Design principles

- **OpenSpec stays agnostic.** We only link to Robot; no Robot semantics live in the OpenSpec schema.
- **References over generation.** The mapper verifies and indexes your references; it does not author tests or keywords.
- **Profiles by URL.** `bdd_ref.source` must be a URL listed in `bdd-registry.yaml` for Robot.

## What it does

- Reads an OpenSpec YAML that declares:
  - `profile: https://openspec.dev/profiles/@software`
  - One or more criteria with `bdd_ref` pointing to Robot artifacts
- For each criterion with `bdd_ref`:
  - Validates `bdd_ref.source` matches the Robot profile URL from your registry
  - Resolves `bdd_ref.path` to a `.robot` file (local path or URL)
  - Confirms the named `bdd_ref.scenario` exists as a **Test Case** in that file
  - Records the linkage in `dist/robot/index.json` for traceability
- Optionally copies the referenced `.robot` files into `dist/robot/tests/` **without modification** for distribution

## Inputs (required fields)

- `criteria[].bdd_ref.source` → Robot profile URL  
  Example: `https://openspec.dev/profiles/bdd/robot`
- `criteria[].bdd_ref.path` → path/URL to the `.robot` file
- `criteria[].bdd_ref.scenario` → **Test Case** name inside that file

> Note: Inline step fields (e.g., `given`, `when`, `then`) are **not used**. OpenSpec does not define step syntax.

## Minimal example (OpenSpec → Robot reference)

OpenSpec input:

```yaml
profile: https://openspec.dev/profiles/@software
kind: software
meta:
  id: ROBOT-601
  title: User login with Robot Framework
  owner: app-auth
  priority: P2
  labels: [robot, qa]

requirements:
  - id: ROBOT-601.1
    statement: Robot test covers successful login
    criteria:
      - id: ROBOT-601.1.1
        type: functional
        text: Robot test executes and passes
        bdd_ref:
          source: https://openspec.dev/profiles/bdd/robot
          path: ./ROBOT-LOGIN.robot
          scenario: Valid credentials produce a successful session
```

Robot test file (referenced, maintained in your repo; **not generated by the mapper**):

```
*** Settings ***
Library    SeleniumLibrary

*** Test Cases ***
Valid credentials produce a successful session
    [Tags]    openspec:ROBOT-601.1.1
    Open Browser    https://example.com/login    chrome
    Input Text      id=email    user@example.com
    Input Text      id=password    correcthorsebatterystaple
    Click Button    id=submit
    Location Should Be    https://example.com/dashboard
```

Mapper output (traceability index):

```json
{
  "profile": "https://openspec.dev/profiles/@software",
  "tool": "robot",
  "mappings": [
    {
      "criteria_id": "ROBOT-601.1.1",
      "file": "docs/openspec/implementations/@software/examples/ROBOT-LOGIN.robot",
      "test_case": "Valid credentials produce a successful session"
    }
  ]
}
```

## Field mapping (reference-only)

OpenSpec → Robot

- `meta.id`, `meta.title` → used for discovery and optional copied filenames; **no content is generated**
- `requirements[].id`, `requirements[].statement` → grouping in the index
- `criteria[].id`, `criteria[].text` → index entry details
- `criteria[].bdd_ref.source` → must match Robot profile URL in `bdd-registry.yaml`
- `criteria[].bdd_ref.path` → `.robot` file location
- `criteria[].bdd_ref.scenario` → **Test Case** name inside that `.robot` file

## File layout

**Inputs**
- OpenSpec specs: anywhere (examples under `docs/openspec/implementations/@software/examples/`)
- Robot tests: wherever your suite keeps them (often `tests/`); examples live alongside the YAML

**Outputs**
- Traceability index → `dist/robot/index.json`
- Optional copied tests (unchanged) → `dist/robot/tests/`

## Validation rules applied

- OpenSpec file must validate against `@software` schema
- `bdd_ref.source` must be a URL listed for Robot in `bdd-registry.yaml`
- `bdd_ref.path` must resolve to an existing `.robot` file (local or reachable URL)
- `bdd_ref.scenario` must match an existing **Test Case** name in that file
- Inline step fields are ignored; OpenSpec does **not** define Robot keywords

## Naming guidance

- If files are copied, default filename is `<meta.id>.robot` unless it collides; on collision the original filename is preserved
- Index keys use `criteria.id` as the stable identifier

## Integration tips

- Typical Robot commands:
  - `robot -d output tests/` (runs tests; outputs logs/reports under `output/`)
  - `rebot --merge output/*.xml` (merges result files)
  - Include tags to ease filtering by OpenSpec ID: `[Tags]    openspec:ROBOT-601.1.1`
  - Run by tag: `robot -i openspec:ROBOT-601.1.1 tests/`
- Persist `dist/robot/index.json` as a CI artifact for traceability

## Limitations

- The mapper does **not** generate or modify `.robot` content or keywords
- It does not handle authenticated remote URLs unless your CLI adds credentials
- Assumes UTF-8 and standard Robot syntax

## Quick checklist

- [ ] OpenSpec YAML validates against `@software` schema  
- [ ] `bdd-registry.yaml` includes the Robot profile URL  
- [ ] External `.robot` file exists and contains the named Test Case  
- [ ] `dist/robot/index.json` produced for traceability  
- [ ] (Optional) Tests copied to `dist/robot/tests/` without modification
