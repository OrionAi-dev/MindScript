profile: https://mindscript.dev/profiles/@software
kind: software
meta:
  id: BUG-432
  title: Reset Password flow is reliable and secure
  owner: app-auth
  priority: P0
  labels: [bug, auth, reset-password]

requirements:
  - id: BUG-432.1
    statement: Password reset requests succeed for valid users and enforce safety controls
    criteria:
      - id: BUG-432.1.1
        type: functional
        text: Requesting a reset for a registered email returns 200 and sends a reset email
        bdd_ref:
          source: https://mindscript.dev/profiles/bdd/cucumber
          path: https://example.org/bdd/cucumber/BUG-RESET-PASSWORD.feature
          scenario: Sends reset email for registered address

      - id: BUG-432.1.2
        type: security
        text: Requesting a reset for a non-registered email returns 200 with a generic message and does not send an email (no user enumeration)
        bdd_ref:
          source: https://mindscript.dev/profiles/bdd/cucumber
          path: https://example.org/bdd/cucumber/BUG-RESET-PASSWORD.feature
          scenario: Nonexistent address does not disclose account

      - id: BUG-432.1.3
        type: security
        text: Reset tokens expire after 30 minutes and are single-use; subsequent use returns 401 and prompts a new request
        bdd_ref:
          source: https://mindscript.dev/profiles/bdd/cucumber
          path: https://example.org/bdd/cucumber/BUG-RESET-PASSWORD.feature
          scenario: Token expiry and single-use enforced

      - id: BUG-432.1.4
        type: security
        text: Requests are rate limited to 5 per 15 minutes per user and per IP with backoff after the limit
        bdd_ref:
          source: https://mindscript.dev/profiles/bdd/cucumber
          path: https://example.org/bdd/cucumber/BUG-RESET-PASSWORD.feature
          scenario: Rate limiting per user and IP

      - id: BUG-432.1.5
        type: security
        text: The reset link is bound to user agent + IP hash or includes proof-of-possession to mitigate token theft (configurable)
        bdd_ref:
          source: https://mindscript.dev/profiles/bdd/cucumber
          path: https://example.org/bdd/cucumber/BUG-RESET-PASSWORD.feature
          scenario: Token binding mitigates replay

      - id: BUG-432.1.6
        type: accessibility
        text: Reset page and email meet WCAG 2.1 AA for forms, contrast, focus order, and link text

      - id: BUG-432.1.7
        type: security
        text: Password policy enforced on reset form (minimum 12 chars, 1 upper, 1 lower, 1 digit); weak passwords rejected with non-revealing error
        bdd_ref:
          source: https://mindscript.dev/profiles/bdd/cucumber
          path: https://example.org/bdd/cucumber/BUG-RESET-PASSWORD.feature
          scenario: Password policy enforced on reset

      - id: BUG-432.1.8
        type: security
        text: Reset email contains no PII beyond the address it was sent to, and the link is HTTPS with HSTS and short TTL
